{
  "schema_version": "v1.0.0",
  "last_updated": "2025-12-14",
  "description": "Psyche Profile Data Schema for Character Sheet - Phase 2 Implementation",

  "types": {
    "PsycheCoreStats": {
      "description": "Core personality stats (0..1 range from API, displayed as 0..100)",
      "fields": {
        "clarity": {
          "type": "number",
          "range": "0..1",
          "description": "Mental clarity and focus"
        },
        "courage": {
          "type": "number",
          "range": "0..1",
          "description": "Bravery and willingness to face challenges"
        },
        "connection": {
          "type": "number",
          "range": "0..1",
          "description": "Social connection and empathy"
        },
        "order": {
          "type": "number",
          "range": "0..1",
          "description": "Structure and organization"
        },
        "shadow": {
          "type": "number",
          "range": "0..1",
          "description": "Shadow aspects and unconscious patterns"
        }
      }
    },

    "PsycheState": {
      "description": "Climate axes representing bipolar personality dimensions (0..1 range)",
      "fields": {
        "shadow_light": {
          "type": "number",
          "range": "0..1",
          "labels": ["Shadow", "Light"],
          "description": "Darkness to light spectrum"
        },
        "cold_warm": {
          "type": "number",
          "range": "0..1",
          "labels": ["Cold", "Warm"],
          "description": "Emotional temperature"
        },
        "surface_depth": {
          "type": "number",
          "range": "0..1",
          "labels": ["Surface", "Depth"],
          "description": "Superficiality to depth of engagement"
        },
        "me_we": {
          "type": "number",
          "range": "0..1",
          "labels": ["Me", "We"],
          "description": "Individualism to collectivism"
        },
        "mind_heart": {
          "type": "number",
          "range": "0..1",
          "labels": ["Mind", "Heart"],
          "description": "Rational to emotional orientation"
        }
      }
    },

    "DerivedStatsV1": {
      "description": "Calculated secondary stats (0..100 range)",
      "fields": {
        "vitality": {
          "type": "number",
          "range": "0..100",
          "formula": "avg(clarity, connection) * 100",
          "description": "Life force and energy"
        },
        "willpower": {
          "type": "number",
          "range": "0..100",
          "formula": "avg(courage, order) * 100",
          "description": "Determination and self-control"
        },
        "chaos": {
          "type": "number",
          "range": "0..100",
          "formula": "shadow * 100",
          "description": "Internal chaos and unpredictability"
        },
        "harmony": {
          "type": "number",
          "range": "0..100",
          "formula": "(1 - abs(shadow - connection)) * 100",
          "description": "Inner coherence and alignment"
        }
      }
    },

    "VisualAxesV1": {
      "description": "UI-friendly labels and descriptions for climate axes",
      "structure": "Object with keys matching PsycheState dimensions",
      "example": {
        "shadow_light": {
          "left_label": "Schatten",
          "right_label": "Licht",
          "description": "Dein Verhältnis zu inneren Schatten und Licht"
        }
      }
    },

    "MetaStats": {
      "description": "Aggregate insights about profile state",
      "fields": {
        "intensity": {
          "type": "enum",
          "values": ["quiet", "noticeable", "intense"],
          "description": "Overall profile intensity"
        },
        "tempo": {
          "type": "enum",
          "values": ["calm", "dynamic", "volatile"],
          "description": "Rate of change tendency"
        },
        "shadow_confidence": {
          "type": "number",
          "range": "0..1",
          "description": "Confidence level in shadow measurement"
        },
        "shadow_confirmed": {
          "type": "boolean",
          "threshold": "shadow_confidence >= 0.65",
          "description": "Whether shadow is reliably measured"
        }
      }
    },

    "PsycheDelta": {
      "description": "Represents changes between profile snapshots",
      "fields": {
        "date": {
          "type": "string",
          "format": "ISO8601",
          "description": "When the change occurred"
        },
        "stats_delta": {
          "type": "Partial<PsycheCoreStats>",
          "description": "Changes in core stats"
        },
        "state_delta": {
          "type": "Partial<PsycheState>",
          "description": "Changes in climate axes"
        },
        "movers": {
          "type": "Mover[]",
          "optional": true,
          "description": "Top dimensions that changed (1-3 items)"
        }
      }
    },

    "Mover": {
      "description": "Represents a dimension with significant change",
      "fields": {
        "dimension": {
          "type": "string",
          "description": "Dimension name (e.g., 'clarity', 'shadow_light')"
        },
        "delta": {
          "type": "number",
          "description": "Signed change value (positive or negative)"
        },
        "magnitude": {
          "type": "number",
          "description": "Absolute magnitude for sorting"
        }
      }
    },

    "PsycheProfileV1": {
      "description": "Complete psyche profile - main data contract",
      "required_fields": ["id", "stats", "state"],
      "optional_fields": [
        "user_id",
        "created_at",
        "updated_at",
        "meta_stats",
        "visual_axes",
        "archetype_params",
        "narrative_snippet",
        "last_delta"
      ],
      "fields": {
        "id": "string",
        "user_id": "string?",
        "created_at": "string?",
        "updated_at": "string?",
        "stats": "PsycheCoreStats",
        "state": "PsycheState",
        "meta_stats": "MetaStats?",
        "visual_axes": "VisualAxesV1?",
        "archetype_params": "ArchetypeParams?",
        "narrative_snippet": "string?",
        "last_delta": "PsycheDelta?"
      },
      "graceful_degradation": "UI must handle missing optional fields without crashes"
    }
  },

  "calculations": {
    "derived_stats": {
      "vitality": {
        "formula": "(clarity + connection) / 2",
        "output_range": "0..100",
        "inputs": ["clarity", "connection"]
      },
      "willpower": {
        "formula": "(courage + order) / 2",
        "output_range": "0..100",
        "inputs": ["courage", "order"]
      },
      "chaos": {
        "formula": "shadow",
        "output_range": "0..100",
        "inputs": ["shadow"]
      },
      "harmony": {
        "formula": "1 - abs(shadow - connection)",
        "output_range": "0..100",
        "inputs": ["shadow", "connection"],
        "notes": "Measures alignment between shadow and connection"
      }
    },

    "delta_computation": {
      "threshold": 0.001,
      "description": "Changes below threshold are filtered as floating-point noise",
      "significant_threshold": 0.05,
      "top_movers_count": 3
    },

    "banner_timing": {
      "auto_dismiss_ms": 10000,
      "range_ms": [8000, 12000],
      "manual_close": true
    }
  },

  "files": {
    "types": "/src/types/psyche.ts",
    "domain_logic": {
      "derived_stats": "/src/domain/derivedStats.ts",
      "delta": "/src/domain/delta.ts"
    },
    "hooks": "/src/hooks/usePsycheProfile.ts",
    "tests": "/src/domain/derivedStats.test.ts",
    "mocks": "/src/data/mocks/psyche.ts"
  },

  "ui_integration_notes": {
    "data_flow": "Quiz Completion → API Update → usePsycheProfile → Delta Computation → Banner Display → UI Animations",
    "delta_priority": [
      "1. Use profile.last_delta if available (server-computed)",
      "2. Fall back to snapshot diff if last_delta missing"
    ],
    "movers_display": "Show top 1-3 dimensions with biggest changes",
    "animation_duration": "duration_ms = clamp(450, 1400, 450 + 1200 * delta_magnitude)",
    "accessibility": "prefers-reduced-motion: crossfade + number tween only (<=250ms)"
  },

  "validation_rules": {
    "range_checks": {
      "core_stats": "All values must be 0..1",
      "state_axes": "All values must be 0..1",
      "derived_stats": "All values must be 0..100"
    },
    "required_fields": {
      "PsycheProfileV1": ["id", "stats", "state"],
      "PsycheCoreStats": ["clarity", "courage", "connection", "order", "shadow"],
      "PsycheState": ["shadow_light", "cold_warm", "surface_depth", "me_we", "mind_heart"]
    },
    "graceful_degradation": "Optional fields missing should never cause UI crashes"
  }
}
